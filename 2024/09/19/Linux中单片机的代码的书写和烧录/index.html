<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>marsevilspirit&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,viewport-fit=cover"><link rel="canonical" href="https://www.marsevilspirit.com/"><link rel="apple-touch-icon" sizes="180x180" href="/img/marsevilspirit.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/marsevilspirit.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/marsevilspirit.png"><link rel="mask-icon" type="image/png" href="/img/marsevilspirit.png"><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/et-book.min.css"><link rel="stylesheet" href="/css/LXGW.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/highlight/style1.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="marsevilspirit's blog" type="application/atom+xml">
</head><body><div class="wrapper"><div class="container"><header><h2><a href="/">marsevilspirit&#39;s blog</a></h2></header></div><div class="content"><div class="post"><h1>Linux中单片机的代码的书写和烧录</h1><main class="post-md"><p>今天电装实习，突然对在Linux下写单片机代码和烧录产生了兴趣，<br>特意研究一番，记录一下。</p><h3 id="准备工具"><a href="#准备工具" class="headerlink" title="准备工具"></a>准备工具</h3><p>1.安装<code>sdcc</code>(编译工具):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pacman -S sdcc </span><br></pre></td></tr></table></figure><p>2.安装<code>stcgal</code>(烧录工具):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yay -S stcgal</span><br></pre></td></tr></table></figure><h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><p>这里我没过多研究，主要了解了一下windows的keil的代码迁移到Linux后，怎么修改:</p><p>​</p><table><thead><tr><th></th><th><strong>Keil C51</strong></th><th><strong>SDCC</strong></th><th></th></tr></thead><tbody><tr><td>头文件</td><td>reg51.h&#x2F;reg52.h</td><td>8051.h&#x2F;8052.h</td><td></td></tr><tr><td>端口</td><td>P2^0</td><td>P2_0</td><td></td></tr><tr><td>端口定义</td><td>sbit LED1&#x3D;P2^0；</td><td>#define LED1 P2_0</td><td>替换的时候注意删除后面的分号<code>；</code></td></tr><tr><td>中断声明</td><td>void uart() interrupt 4 using 0</td><td>void uart(void) __interrupt (4) __using (0)</td><td></td></tr><tr><td>特殊类型</td><td>sbit，sfr，bit，code</td><td>__sbit，__sfr，__bit，__code</td><td>Keil中的很多特殊类型前面加上__就是sdcc中对应的类型。</td></tr><tr><td>_nop()_</td><td>Keil C51专有</td><td>#define _nop_() __asm NOP __endasm</td><td></td></tr><tr><td>intrins.h</td><td>Keil C51专有， SDCC需自己创建</td><td>自行创建</td><td></td></tr></tbody></table><h3 id="编译代码"><a href="#编译代码" class="headerlink" title="编译代码"></a>编译代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sdcc your_program.c</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ packihx your_program.ihx &gt; your_program.hex</span><br></pre></td></tr></table></figure><h3 id="烧录"><a href="#烧录" class="headerlink" title="烧录"></a>烧录</h3><p>接入USB, 输入命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo stcgal your_program.hex</span><br></pre></td></tr></table></figure><p>这时会提醒你：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Waiting for MCU, please cycle power: </span><br></pre></td></tr></table></figure><p>此时只需要关开一下开关就会自动烧录了。</p><h3 id="蜂鸣器实现蜜雪冰城"><a href="#蜂鸣器实现蜜雪冰城" class="headerlink" title="蜂鸣器实现蜜雪冰城"></a>蜂鸣器实现蜜雪冰城</h3><p>下面是我用蜂鸣器实现蜜雪冰城的音乐😆(与光立方结合在一起):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D1 P1_0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D2 P1_1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D3 P1_2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D4 P1_3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D5 P1_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D6 P1_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D7 P1_6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> D8 P1_7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U1 P2_0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U2 P2_1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U3 P2_2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint  unsigned int</span></span><br><span class="line">uchar Count;</span><br><span class="line"><span class="type">int</span> mode_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Speak P1_3			 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led1 P0_0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led2 P0_1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led3 P0_2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led4 P0_3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led5 P0_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led6 P0_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led7 P0_6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> led8 P0_7</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> __code SONG[] = &#123;</span><br><span class="line">    <span class="comment">/*0xFE, 0x20, // 0     */</span></span><br><span class="line">    <span class="comment">/*0x39, 0x20, // 6low*/</span></span><br><span class="line">    <span class="comment">/*0x30, 0x20, // 1*/</span></span><br><span class="line">    <span class="comment">/*0x2b, 0x20, // 2*/</span></span><br><span class="line">    <span class="comment">/*0x26, 0x20, // 3*/</span></span><br><span class="line">    <span class="comment">/*0x23, 0x20, // 4*/</span></span><br><span class="line">    <span class="comment">/*0x20, 0x20, // 5*/</span></span><br><span class="line">    <span class="comment">/*0x1c, 0x20, // 6*/</span></span><br><span class="line">    <span class="comment">/*0x19, 0x20, // 7*/</span></span><br><span class="line"></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3 </span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x1c</span>, <span class="number">0x10</span>, <span class="comment">// 6</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x10</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x10</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x20</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x40</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0xFE</span>, <span class="number">0x40</span>, <span class="comment">// 0 //你爱我， 我爱你， 蜜雪冰城甜蜜蜜</span></span><br><span class="line"></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3 </span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x1c</span>, <span class="number">0x10</span>, <span class="comment">// 6</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x10</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x10</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x20</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x40</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0xFE</span>, <span class="number">0x40</span>, <span class="comment">// 0 //你爱我， 我爱你， 蜜雪冰城甜蜜蜜</span></span><br><span class="line">                </span><br><span class="line">    <span class="number">0x23</span>, <span class="number">0x40</span>, <span class="comment">// 4</span></span><br><span class="line">    <span class="number">0x23</span>, <span class="number">0x40</span>, <span class="comment">// 4</span></span><br><span class="line">    <span class="number">0x23</span>, <span class="number">0x20</span>, <span class="comment">// 4</span></span><br><span class="line">    <span class="number">0x1c</span>, <span class="number">0x60</span>, <span class="comment">// 6.</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x40</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0xFE</span>, <span class="number">0x40</span>, <span class="comment">// 0 //你爱我呀，我爱你，</span></span><br><span class="line"></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3 </span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x1c</span>, <span class="number">0x10</span>, <span class="comment">// 6</span></span><br><span class="line">    <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x10</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x10</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x20</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="number">0x2b</span>, <span class="number">0x20</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="number">0xFE</span>, <span class="number">0x40</span>, <span class="comment">// 0 //你爱我， 我爱你， 蜜雪冰城甜蜜蜜</span></span><br><span class="line">    </span><br><span class="line">    <span class="number">0xFF</span>,</span><br><span class="line">    <span class="number">0x00</span>    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mode1</span><span class="params">()</span> &#123;</span><br><span class="line">        U1=<span class="number">1</span>; </span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">1</span>;</span><br><span class="line">        D4=<span class="number">1</span>;</span><br><span class="line">        D5=<span class="number">1</span>;</span><br><span class="line">        D6=<span class="number">1</span>;</span><br><span class="line">        D7=<span class="number">1</span>;</span><br><span class="line">        D8=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U1=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        U2=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">0</span>;</span><br><span class="line">        D3=<span class="number">0</span>;</span><br><span class="line">        D4=<span class="number">0</span>;</span><br><span class="line">        D5=<span class="number">0</span>;</span><br><span class="line">        D6=<span class="number">0</span>;</span><br><span class="line">        D7=<span class="number">0</span>;</span><br><span class="line">        D8=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U2=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        U3=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">0</span>;</span><br><span class="line">        D2=<span class="number">0</span>;</span><br><span class="line">        D3=<span class="number">0</span>;</span><br><span class="line">        D4=<span class="number">0</span>;</span><br><span class="line">        D5=<span class="number">0</span>;</span><br><span class="line">        D6=<span class="number">0</span>;</span><br><span class="line">        D7=<span class="number">0</span>;</span><br><span class="line">        D8=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U3=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mode2</span><span class="params">()</span> &#123;</span><br><span class="line">        U1=<span class="number">1</span>; </span><br><span class="line">        D1=<span class="number">0</span>;</span><br><span class="line">        D2=<span class="number">0</span>;</span><br><span class="line">        D3=<span class="number">0</span>;</span><br><span class="line">        D4=<span class="number">0</span>;</span><br><span class="line">        D5=<span class="number">0</span>;</span><br><span class="line">        D6=<span class="number">0</span>;</span><br><span class="line">        D7=<span class="number">0</span>;</span><br><span class="line">        D8=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U1=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        U2=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">0</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">1</span>;</span><br><span class="line">        D4=<span class="number">1</span>;</span><br><span class="line">        D5=<span class="number">1</span>;</span><br><span class="line">        D6=<span class="number">1</span>;</span><br><span class="line">        D7=<span class="number">1</span>;</span><br><span class="line">        D8=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U2=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        U3=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">0</span>;</span><br><span class="line">        D4=<span class="number">0</span>;</span><br><span class="line">        D5=<span class="number">0</span>;</span><br><span class="line">        D6=<span class="number">0</span>;</span><br><span class="line">        D7=<span class="number">0</span>;</span><br><span class="line">        D8=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U3=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mode3</span><span class="params">()</span> &#123;</span><br><span class="line">        U1=<span class="number">1</span>; </span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">1</span>;</span><br><span class="line">        D4=<span class="number">1</span>;</span><br><span class="line">        D5=<span class="number">1</span>;</span><br><span class="line">        D6=<span class="number">1</span>;</span><br><span class="line">        D7=<span class="number">1</span>;</span><br><span class="line">        D8=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">// delay02s();</span></span><br><span class="line">        U1=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        U2=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">1</span>;</span><br><span class="line">        D4=<span class="number">1</span>;</span><br><span class="line">        D5=<span class="number">1</span>;</span><br><span class="line">        D6=<span class="number">1</span>;</span><br><span class="line">        D7=<span class="number">1</span>;</span><br><span class="line">        D8=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U2=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">        U3=<span class="number">1</span>;</span><br><span class="line">        D1=<span class="number">1</span>;</span><br><span class="line">        D2=<span class="number">1</span>;</span><br><span class="line">        D3=<span class="number">0</span>;</span><br><span class="line">        D4=<span class="number">0</span>;</span><br><span class="line">        D5=<span class="number">0</span>;</span><br><span class="line">        D6=<span class="number">0</span>;</span><br><span class="line">        D7=<span class="number">0</span>;</span><br><span class="line">        D8=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//delay02s();</span></span><br><span class="line">        U3=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Time0_Init</span><span class="params">()</span> &#123;</span><br><span class="line">    TMOD = <span class="number">0x01</span>; <span class="comment">// 定时器0模式1</span></span><br><span class="line">    IE   = <span class="number">0x82</span>; <span class="comment">// 使能定时器0中断</span></span><br><span class="line">    TH0  = <span class="number">0xDC</span>; <span class="comment">// 设置定时器初值</span></span><br><span class="line">    TL0  = <span class="number">0x00</span>;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Time0_Int</span><span class="params">()</span> __<span class="title function_">interrupt</span> <span class="params">(<span class="number">1</span>)</span> &#123;</span><br><span class="line">    TH0 = <span class="number">0xDC</span>; <span class="comment">// 定时器重载</span></span><br><span class="line">    TL0 = <span class="number">0x00</span>;</span><br><span class="line">    Count++;			</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_xMs</span><span class="params">(uint x)</span> &#123;</span><br><span class="line">    uint i, j;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; x; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Control_LEDs</span><span class="params">(uchar note)</span> &#123;</span><br><span class="line">    <span class="comment">// 先关闭所有LED</span></span><br><span class="line">    led1 = led2 = led3 = led4 = led5 = led6 = led7 = led8 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(note) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x30</span>: led1 = <span class="number">0</span>; <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x2b</span>: led2 = <span class="number">0</span>; <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x26</span>: led3 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x23</span>: led4 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x20</span>: led5 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x1c</span>: led6 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x19</span>: led7 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xFE</span>: led8 = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">chose_mode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (mode_count % <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: mode1(); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: mode2(); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: mode3(); <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mode_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 播放歌曲</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Play_Song</span><span class="params">()</span> &#123;</span><br><span class="line">    uchar Temp1, Temp2;</span><br><span class="line">    uint Addr = <span class="number">0</span>; </span><br><span class="line">    Count = <span class="number">0</span>;			</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        Temp1 = SONG[Addr++]; <span class="comment">// 获取音符</span></span><br><span class="line">        <span class="keyword">if</span> (Temp1 == <span class="number">0xFF</span>) &#123;</span><br><span class="line">            TR0 = <span class="number">0</span>; <span class="comment">// 停止定时器</span></span><br><span class="line">            Delay_xMs(<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">// 播放结束</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Temp1 == <span class="number">0x00</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 播放结束</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Temp2 = SONG[Addr++]; <span class="comment">// 获取持续时间</span></span><br><span class="line">            TR0 = <span class="number">1</span>; <span class="comment">// 启动定时器</span></span><br><span class="line">            <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">                Speak = (Speak == <span class="number">0</span>) ? <span class="number">1</span> : <span class="number">0</span>; <span class="comment">// 切换发声状态</span></span><br><span class="line">                Delay_xMs(Temp1);</span><br><span class="line">                <span class="keyword">if</span>(Temp2 == Count) &#123;</span><br><span class="line">                    Count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Control_LEDs(Temp1); <span class="comment">// 控制LED</span></span><br><span class="line">            chose_mode(); <span class="comment">// 选择模式</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    U1 = <span class="number">0</span>;</span><br><span class="line">    U2 = <span class="number">0</span>;</span><br><span class="line">    U3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    Time0_Init();	</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        Play_Song(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></main><p>Sep 2024</p></div></div></div><footer class="footer"><div class="content has-text-centered"><p><a href="/about">About Mars</a> | <a href="https://github.com/marsevilspirit" , target="_blank">Github</a> | <a href="mailto:marsevilspirit@gmail.com">Email</a></p></div></footer></body></html>